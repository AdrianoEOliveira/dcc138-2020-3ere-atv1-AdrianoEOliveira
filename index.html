<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste 01</title>
</head>
<body>
    <h1>Teste 01</h1>
    <canvas></canvas>
    <script>
        let canvas = document.querySelector("canvas");
        let ctx = canvas.getContext("2d");
        canvas.width=640;
        canvas.height= 500;
        let t0;
        let dt;
        let V=150;

        let p = {
            x : 100,
            ax : 0,
            vx : 0,
            y : 100,
            ay : 0,
            vy : 0,
            cor:"white",
            desenhar: desenharElemento,
            mover: MoverElemento,
        }

        let e = {
            x: 300,
            ax: 0,
            vx: 0,
            y : 300,
            ay : 0,
            vy : 0,
            cor: "red",
            desenhar: function()
            {
            ctx.fillStyle="red";
            ctx.fillRect(this.x,this.y,30,30);
            },
            mover: MoverElemento,
            controla: perseguir,
        }

        requestAnimationFrame(desenha);
        function desenha(t)
        {
            if(t0=== undefined) t0 =t;
            dt=(t-t0)/1000;
            //desenha fundo;
            ctx.fillStyle="blue";
            ctx.fillRect(0,0,canvas.width,canvas.height);

            //Controladores
            e.controla(p);
            //e.controla({x:250,y:250})
            
            //atualiza din√¢mica dos elementos
            p.mover();

            e.mover();

            //desenha elementos;
            p.desenhar();

            e.desenhar();

            requestAnimationFrame(desenha);
            t0=t;
        }

        function MoverElemento()
        {
            this.vx = this.vx + (this.ax*dt);
            this.x = this.x + this.vx*dt;
            this.vy = this.vy+ (this.ay*dt);
            this.y = this.y + this.vy*dt;
        }
        function desenharElemento()
        {
            ctx.fillStyle=this.cor;
            ctx.fillRect(this.x,this.y,30,30);
        }
        function perseguir(alvo)
        {
            this.ay = ((alvo.y - this.y)*0.5) - 0.2*this.vy;
            this.ax = ((alvo.x - this.x)*0.5) - 0.2*this.vx;
        }
        function Fugir(alvo)
        {
            this.ay = ((alvo.y - this.y)*-0.5) - 0.2*this.vy;
            this.ax = ((alvo.x - this.x)*-0.5) - 0.2*this.vx;
        }

        addEventListener("keydown",teclaPressionada);
        addEventListener("keyup",teclaSolta);
        function teclaPressionada(event)
        {
            //Controle de velocidades
            console.log(event.key);
            switch (event.key) 
            {
                case "ArrowUp":
                    p.ay = -V;
                    break;
                case "ArrowDown":
                    p.ay = +V;
                    break;
                case "ArrowLeft":
                    p.ax = -V;
                    break;
                case "ArrowRight":
                    p.ax = +V;
                    break;
            
                default:
                    break;
            }
        }
        function teclaSolta(event)
        {
            //Controle de velocidades
            console.log(event.key);
            switch (event.key) 
            {
                case "ArrowUp":
                    p.vy = 0;
                    p.ay = 0;
                    break;
                case "ArrowDown":
                    p.vy = 0;
                    p.ay = 0;
                    break;
                case "ArrowLeft":
                    p.vx = 0;
                    p.ax = 0;
                    break;
                case "ArrowRight":
                    p.vx = 0;
                    p.ax = 0;
                    break;
            
                default:
                    break;
            }
        }
    </script>
</body>
</html>